# –õ–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–∞—è —Ä–∞–±–æ—Ç–∞ ‚Ññ6. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

## 1. –¶–µ–ª—å —Ä–∞–±–æ—Ç—ã

–¶–µ–ª—å—é –Ω–∞—Å—Ç–æ—è—â–µ–π –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–æ–π —Ä–∞–±–æ—Ç—ã —è–≤–ª—è–µ—Ç—Å—è –æ—Å–≤–æ–µ–Ω–∏–µ –ø–æ–¥—Ö–æ–¥–æ–≤ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ Flutter-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è. –í –ø—Ä–æ—Ü–µ—Å—Å–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Ä–∞–±–æ—Ç—ã —Å—Ç—É–¥–µ–Ω—Ç—ã –ø–æ–ª—É—á–∞—é—Ç –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –Ω–∞–≤—ã–∫–∏:

- –Ω–∞–ø–∏—Å–∞–Ω–∏—è –º–æ–¥—É–ª—å–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤ –¥–ª—è —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤ –∏ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏;
- –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ `mockito` –¥–ª—è –∏–∑–æ–ª—è—Ü–∏–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –∏ –ø–æ–¥–º–µ–Ω—ã —Ä–µ–∞–ª—å–Ω—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –¥–∞–Ω–Ω—ã—Ö;
- –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ –≤—ã–∑–æ–≤–æ–≤ –º–µ—Ç–æ–¥–æ–≤ –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π;
- –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ —Å—Ä–µ–¥—ã –∏ –∑–∞–ø—É—Å–∫–∞ —Ç–µ—Å—Ç–æ–≤ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º `test`, `flutter_test` –∏ `integration_test`.

–í –∫–∞—á–µ—Å—Ç–≤–µ –æ–±—ä–µ–∫—Ç–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤—ã—Å—Ç—É–ø–∞—é—Ç –∫–ª–∞—Å—Å—ã, —Ä–µ–∞–ª–∏–∑—É—é—â–∏–µ –ª–æ–≥–∏–∫—É –ø–æ–ª—É—á–µ–Ω–∏—è –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö (–Ω–∞–ø—Ä–∏–º–µ—Ä, `CurrencyRepositoryImpl`). –†–µ–∑—É–ª—å—Ç–∞—Ç–æ–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–æ–π —Ä–∞–±–æ—Ç—ã —è–≤–ª—è–µ—Ç—Å—è –Ω–∞–±–æ—Ä –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤, –æ–±–µ—Å–ø–µ—á–∏–≤–∞—é—â–∏—Ö –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—é –∫–ª—é—á–µ–≤—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è –º–µ–∂–¥—É —Å–ª–æ—è–º–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

## 2. –û–±—â–µ–µ –æ–ø–∏—Å–∞–Ω–∏–µ

–í–æ Flutter-–ø—Ä–æ–µ–∫—Ç–∞—Ö —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ ‚Äî —ç—Ç–æ –Ω–µ –ø—Ä–æ—Å—Ç–æ –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ —Ä–∞–±–æ—Ç—ã –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤, –Ω–æ –∏ –≤–∞–∂–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞ –∫–æ–¥–∞ –Ω–∞ –≤—Å–µ—Ö —ç—Ç–∞–ø–∞—Ö –∂–∏–∑–Ω–µ–Ω–Ω–æ–≥–æ —Ü–∏–∫–ª–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è. –õ–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–∞—è —Ä–∞–±–æ—Ç–∞ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∞ –Ω–∞ –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –æ—Å–≤–æ–µ–Ω–∏–µ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —É—Ä–æ–≤–Ω–µ–π —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è, –≤–∫–ª—é—á–∞—è –º–æ–¥—É–ª—å–Ω—ã–µ –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã, —Å —É–ø–æ—Ä–æ–º –Ω–∞ –∏–∑–æ–ª—è—Ü–∏—é –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏ –æ—Ç –≤–Ω–µ—à–Ω–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π.

–û—Å–æ–±–æ–µ –≤–Ω–∏–º–∞–Ω–∏–µ —É–¥–µ–ª—è–µ—Ç—Å—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—é –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ `mockito`, –∫–æ—Ç–æ—Ä–∞—è –ø–æ–∑–≤–æ–ª—è–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –∑–∞–º–µ—â–∞—é—â–∏–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤ –∏–∑–æ–ª—è—Ü–∏–∏. –°—Ç—É–¥–µ–Ω—Ç—ã –Ω–∞—É—á–∞—Ç—Å—è –Ω–µ —Ç–æ–ª—å–∫–æ –∏–º–∏—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ–≤–µ–¥–µ–Ω–∏–µ –≤–Ω–µ—à–Ω–∏—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –¥–∞–Ω–Ω—ã—Ö, –Ω–æ –∏ –ø—Ä–æ–≤–µ—Ä—è—Ç—å –≤—ã–∑–æ–≤—ã, –∞—Ä–≥—É–º–µ–Ω—Ç—ã –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –º–æ–∫–æ–≤.

–¢–∞–∫–∂–µ –≤ —Ä–∞–±–æ—Ç–µ —Ä–∞—Å—Å–º–∞—Ç—Ä–∏–≤–∞—é—Ç—Å—è –ø–æ–¥—Ö–æ–¥—ã –∫ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–∏—é —Ç–µ—Å—Ç–æ–≤ –ø–æ —Å–ª–æ—è–º –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã, –∑–∞–ø—É—Å–∫—É —Ç–µ—Å—Ç–æ–≤ –≤ —Ä–∞–∑–Ω—ã—Ö —Å—Ä–µ–¥–∞—Ö (`flutter_test`, `test`, `integration_test`) –∏ –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤. –ü—Ä–µ–¥–ª–∞–≥–∞–µ–º—ã–µ –ø—Ä–∞–∫—Ç–∏–∫–∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è–º –ø–æ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—é —É—Å—Ç–æ–π—á–∏–≤—ã—Ö –∏ –ª–µ–≥–∫–æ —Å–æ–ø—Ä–æ–≤–æ–∂–¥–∞–µ–º—ã—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤ –Ω–∞ Flutter.

–í —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Ä–∞–±–æ—Ç—ã —Å—Ç—É–¥–µ–Ω—Ç—ã —Å–º–æ–≥—É—Ç —É–≤–µ—Ä–µ–Ω–Ω–æ –ø—Ä–∏–º–µ–Ω—è—Ç—å —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ, –æ–±–µ—Å–ø–µ—á–∏–≤–∞—è –Ω–∞–¥—ë–∂–Ω–æ—Å—Ç—å –∫–ª—é—á–µ–≤—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –±–µ–∑ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ —Ä—É—á–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è.

## 3. –û—Å–Ω–æ–≤–Ω–∞—è —á–∞—Å—Ç—å

### –û–±—ä—è–≤–ª–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

–î–ª—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –º–æ–¥—É–ª—å–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø–æ–¥–∫–ª—é—á–∏—Ç—å –≤ –ø—Ä–æ–µ–∫—Ç —Å–ª–µ–¥—É—é—â–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏. –û—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª `pubspec.yaml` –∏ –¥–æ–±–∞–≤—å—Ç–µ –∏–ª–∏ —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç —Å–ª–µ–¥—É—é—â–∏–µ –∑–∞–ø–∏—Å–∏ –≤ —Ä–∞–∑–¥–µ–ª–µ `dev_dependencies`:

```yaml
dev_dependencies:
  flutter_test:
    sdk: flutter

  integration_test:
    sdk: flutter

  test: 1.25.15
  mockito: 5.4.6

  build_runner: 2.4.15
```

- `test` ‚Äî –Ω–∞—Ç–∏–≤–Ω–∞—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ Dart –¥–ª—è —é–Ω–∏—Ç-—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–µ–Ω–Ω–æ –¥–ª—è —Ç–µ—Å—Ç–æ–≤, –Ω–µ –∑–∞–≤–∏—Å—è—â–∏—Ö –æ—Ç Flutter SDK (–Ω–∞–ø—Ä–∏–º–µ—Ä, —É—Ç–∏–ª–∏—Ç–∞—Ä–Ω—ã—Ö –∫–ª–∞—Å—Å–æ–≤, —Ñ—É–Ω–∫—Ü–∏–π, –ø–∞—Ä—Å–µ—Ä–æ–≤ –∏ –¥—Ä.).
- `flutter_test` ‚Äî –≤—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–ª—è –Ω–∞–ø–∏—Å–∞–Ω–∏—è —é–Ω–∏—Ç- –∏ –≤–∏–¥–∂–µ—Ç-—Ç–µ—Å—Ç–æ–≤ –≤–æ Flutter. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤ –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–µ –ø—Ä–æ–µ–∫—Ç–æ–≤.
- `integration_test` ‚Äî –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π –ø–∞–∫–µ—Ç –¥–ª—è –Ω–∞–ø–∏—Å–∞–Ω–∏—è —Å–∫–≤–æ–∑–Ω—ã—Ö (end-to-end) —Ç–µ—Å—Ç–æ–≤, –º–æ–¥–µ–ª–∏—Ä—É—é—â–∏—Ö –ø–æ–≤–µ–¥–µ–Ω–∏–µ —Ä–µ–∞–ª—å–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
- `mockito` ‚Äî –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ø–æ–¥–º–µ–Ω–Ω—ã—Ö —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–π (mock-–æ–±—ä–µ–∫—Ç–æ–≤) –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤ –∏ –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–π. –ù–µ–æ–±—Ö–æ–¥–∏–º –¥–ª—è –∏–∑–æ–ª—è—Ü–∏–∏ —Ç–µ—Å—Ç–∏—Ä—É–µ–º–æ–≥–æ –∫–ª–∞—Å—Å–∞ –æ—Ç –µ–≥–æ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π.
- `build_runner` ‚Äî —Å–ª—É–∂–µ–±–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç, –æ–±–µ—Å–ø–µ—á–∏–≤–∞—é—â–∏–π –≥–µ–Ω–µ—Ä–∞—Ü–∏—é mock-–∫–ª–∞—Å—Å–æ–≤ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∞–Ω–Ω–æ—Ç–∞—Ü–∏–π `@GenerateMocks`.

> ‚ö†Ô∏è –û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ: —Ö–æ—Ç—è `flutter_test` –∏ `test` –∏–º–µ—é—Ç —Å—Ö–æ–∂—É—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å, –æ–Ω–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤ —Ä–∞–∑–Ω—ã—Ö –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞—Ö.
–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ `test` –Ω–µ —Ç—Ä–µ–±—É–µ—Ç Flutter-–æ–∫—Ä—É–∂–µ–Ω–∏—è –∏ –º–æ–∂–µ—Ç –ø—Ä–∏–º–µ–Ω—è—Ç—å—Å—è –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —á–∏—Å—Ç–æ–≥–æ Dart-–∫–æ–¥–∞, —á—Ç–æ –æ—Å–æ–±–µ–Ω–Ω–æ –∞–∫—Ç—É–∞–ª—å–Ω–æ –¥–ª—è —É—Ç–∏–ª–∏—Ç –∏ –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã—Ö —Å–ª–æ—ë–≤ –ø—Ä–æ–µ–∫—Ç–∞.

### –û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Ç–µ—Å—Ç–æ–≤

–î–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è —á–∏—Ç–∞–µ–º–æ—Å—Ç–∏ –∏ —Ä–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç–∏ —Ç–µ—Å—Ç–æ–≤–æ–π –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ø—Ä–æ–µ–∫—Ç–∞ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –ø—Ä–∏–¥–µ—Ä–∂–∏–≤–∞—Ç—å—Å—è —á—ë—Ç–∫–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –∫–∞—Ç–∞–ª–æ–≥–æ–≤. –¢–µ—Å—Ç—ã —Ä–∞–∑–¥–µ–ª—è—é—Ç—Å—è –ø–æ —Ç–∏–ø–∞–º –∏ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—é:

#### –ö–∞—Ç–∞–ª–æ–≥ `test/`

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Ä–∞–∑–º–µ—â–µ–Ω–∏—è:

- **–º–æ–¥—É–ª—å–Ω—ã—Ö (—é–Ω–∏—Ç) —Ç–µ—Å—Ç–æ–≤**: –ø—Ä–æ–≤–µ—Ä—è—é—Ç —Ä–∞–±–æ—Ç—É –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –∫–ª–∞—Å—Å–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤, –º–∞–ø–ø–µ—Ä–æ–≤, —É—Ç–∏–ª–∏—Ç);
- **–≤–∏–¥–∂–µ—Ç-—Ç–µ—Å—Ç–æ–≤**: –æ—Ö–≤–∞—Ç—ã–≤–∞—é—Ç –ø–æ–≤–µ–¥–µ–Ω–∏–µ UI-–∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –≤ –∏–∑–æ–ª—è—Ü–∏–∏;
- **–≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤**: mock-—Ä–µ–∞–ª–∏–∑–∞—Ü–∏–π, —Ñ–∏–∫—Å—Ç—É—Ä, –∑–∞–≥–æ—Ç–æ–≤–ª–µ–Ω–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π.

#### –ö–∞—Ç–∞–ª–æ–≥ `integration_test/`

–ü—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –¥–ª—è —Ä–∞–∑–º–µ—â–µ–Ω–∏—è **–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö (end-to-end) —Ç–µ—Å—Ç–æ–≤**, –º–æ–¥–µ–ª–∏—Ä—É—é—â–∏—Ö —Ä–µ–∞–ª—å–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º.

> ‚ö†Ô∏è –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã —Ä–∞–±–æ—Ç–∞—é—Ç —Å –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–º —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (–ø–æ–¥–æ–±–Ω–æ —Ç–æ–º—É, —á—Ç–æ –≤—ã –∑–∞–ø—É—Å–∫–∞–ª–∏ —Å –ø–æ–º–æ—â—å—é `runApp(...)`) –∏ –ø–æ–∑–≤–æ–ª—è—é—Ç –ø—Ä–æ–≤–µ—Ä—è—Ç—å –ø–æ–≤–µ–¥–µ–Ω–∏–µ –Ω–∞ —É—Ä–æ–≤–Ω–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤, –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ –º–µ–∂–¥—É —ç–∫—Ä–∞–Ω–∞–º–∏, —Ä–∞–±–æ—Ç—ã –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –∏ –ø–ª–∞—Ç—Ñ–æ—Ä–º–µ–Ω–Ω—ã—Ö –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–π. –≠—Ç–æ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ –≤—ã–∑–æ–≤ `IntegrationTestWidgetsFlutterBinding.ensureInitialized()`, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–¥–∫–ª—é—á–∞–µ—Ç —Ä–µ–∞–ª—å–Ω—ã–π –¥–≤–∏–∂–æ–∫ Flutter –∫ —Å—Ä–µ–¥–µ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è –Ω–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ –∏–ª–∏ —ç–º—É–ª—è—Ç–æ—Ä–µ, –≤ –æ—Ç–ª–∏—á–∏–µ –æ—Ç –≤–∏–¥–∂–µ—Ç-—Ç–µ—Å—Ç–æ–≤, –≤—ã–ø–æ–ª–Ω—è—é—â–∏—Ö—Å—è –≤ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ–π —Å—Ä–µ–¥–µ.

#### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏

- –ù–∞–∑–≤–∞–Ω–∏—è —Ç–µ—Å—Ç–æ–≤—ã—Ö —Ñ–∞–π–ª–æ–≤ –¥–æ–ª–∂–Ω—ã —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å –∏–º–µ–Ω–∞–º —Ç–µ—Å—Ç–∏—Ä—É–µ–º—ã—Ö –∫–ª–∞—Å—Å–æ–≤ —Å –ø–æ—Å—Ç—Ñ–∏–∫—Å–æ–º `_test.dart`;
- –§–∞–π–ª –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –≥—Ä—É–ø–ø—É `group()` (–Ω–∞–ø—Ä–∏–º–µ—Ä, –µ—Å–ª–∏ –≤—ã —Ö–æ—Ç–∏—Ç–µ –∏—Ö —Ä–∞–∑–¥–µ–ª–∏—Ç—å –ø–æ –∫–∞–∫–æ–º—É-—Ç–æ –ø—Ä–∏–Ω—Ü–∏–ø—É) –∏ –ø–æ–Ω—è—Ç–Ω—ã–µ –∏–º–µ–Ω–∞ —Ç–µ—Å—Ç–æ–≤ (`test()`);
- –î–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ mock-–æ–±—ä–µ–∫—Ç–æ–≤ —Å–æ–∑–¥–∞—ë—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω—ã–π —Ñ–∞–π–ª –≤ `test/mocks/` —Å –∞–Ω–Ω–æ—Ç–∞—Ü–∏–µ–π `@GenerateMocks` –∏ –ø–æ—Å–ª–µ–¥—É—é—â–∏–º –∑–∞–ø—É—Å–∫–æ–º `build_runner`.

> ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∞–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Ç–µ—Å—Ç–æ–≤ –æ–±–ª–µ–≥—á–∞–µ—Ç –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞, –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—É—é —Ä–∞–∑—Ä–∞–±–æ—Ç–∫—É –∏ –ø—Ä–æ–≤–µ–¥–µ–Ω–∏–µ —Ä–µ–≤—å—é.

### –°–æ–∑–¥–∞–Ω–∏–µ –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ mock-–æ–±—ä–µ–∫—Ç–æ–≤

–î–ª—è –º–æ–¥—É–ª—å–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∫–ª–∞—Å—Å–æ–≤, –∏–º–µ—é—â–∏—Ö –≤–Ω–µ—à–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –¥–æ—Å—Ç—É–ø –∫ REST API –∏–ª–∏ –ª–æ–∫–∞–ª—å–Ω–æ–π –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö), –≤–∞–∂–Ω–æ —É–º–µ—Ç—å –ø–æ–¥–º–µ–Ω—è—Ç—å —ç—Ç–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —Å —Ü–µ–ª—å—é –∏–∑–æ–ª—è—Ü–∏–∏ —Ç–µ—Å—Ç–∏—Ä—É–µ–º–æ–π –ª–æ–≥–∏–∫–∏. –î–ª—è —ç—Ç–æ–≥–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ `mockito`, –ø–æ–∑–≤–æ–ª—è—é—â–∞—è —Å–æ–∑–¥–∞–≤–∞—Ç—å mock-–æ–±—ä–µ–∫—Ç—ã ‚Äî –ø–æ–¥–¥–µ–ª—å–Ω—ã–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤, –ø–æ–≤–µ–¥–µ–Ω–∏–µ –∫–æ—Ç–æ—Ä—ã—Ö –º–æ–∂–Ω–æ –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä–æ–≤–∞—Ç—å –≤—Ä—É—á–Ω—É—é.

#### –®–∞–≥ 1. –°–æ–∑–¥–∞–Ω–∏–µ —Ñ–∞–π–ª–∞ —Å –∞–Ω–Ω–æ—Ç–∞—Ü–∏–µ–π

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `test/mocks/repository.dart`, —Å–æ–¥–µ—Ä–∂–∞—â–∏–π –∞–Ω–Ω–æ—Ç–∞—Ü–∏—é `@GenerateMocks` —Å –ø–µ—Ä–µ—á–Ω–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –∑–∞–º–æ–∫–∏—Ä–æ–≤–∞—Ç—å:

```dart
import 'package:mockito/annotations.dart';
import 'package:mad_flutter_practicum/domain/repository/news_repository.dart';
import 'package:mad_flutter_practicum/domain/repository/settings_repository.dart';
import 'package:mad_flutter_practicum/domain/repository/currency_repository.dart';

@GenerateMocks([CurrencyRepository, NewsRepository, SettingsRepository])
void main() {}
```

–ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ –¥–ª—è `test/mocks/datasource.dart`:

```dart
import 'package:mad_flutter_practicum/domain/datasource/db_datasource.dart';
import 'package:mad_flutter_practicum/domain/datasource/preference_datasource.dart';
import 'package:mad_flutter_practicum/domain/datasource/rest_datasource.dart';
import 'package:mockito/annotations.dart';

@GenerateMocks([RestDatasource, DbDatasource, PreferenceDatasource])
void main() {}
```

#### –®–∞–≥ 2. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è mock-–∫–ª–∞—Å—Å–æ–≤
–î–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ mock-—Ä–µ–∞–ª–∏–∑–∞—Ü–∏–π –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –∫–æ–º–∞–Ω–¥—É:

```bash
dart run build_runner build
```

–í —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ –≤ —Ç–æ–π –∂–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –±—É–¥—É—Ç —Å–æ–∑–¥–∞–Ω—ã —Ñ–∞–π–ª—ã `repository.mocks.dart` –∏ `datasource.mocks.dart`, —Å–æ–¥–µ—Ä–∂–∞—â–∏–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫–ª–∞—Å—Å—ã, —É–∫–∞–∑–∞–Ω–Ω—ã–µ –≤ –∞–Ω–Ω–æ—Ç–∞—Ü–∏–∏ —Å –ø—Ä–∏–ø–∏—Å–∫–æ–π `Mock`.

#### –®–∞–≥ 3. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ mock-–æ–±—ä–µ–∫—Ç–æ–≤ –≤ —Ç–µ—Å—Ç–∞—Ö
Mock-–æ–±—ä–µ–∫—Ç—ã –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ —Ç–µ—Å—Ç–∞—Ö –∫–∞–∫ –∑–∞–º–µ–Ω—É —Ä–µ–∞–ª—å–Ω—ã–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º –ø–æ—Å–∫–æ–ª—å–∫—É –æ–Ω–∏ –Ω–∞—Å–ª–µ–¥—É—é—Ç —É–∫–∞–∑–∞–Ω–Ω—ã–µ –∫–ª–∞—Å—Å—ã:

```dart
// –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏
final CurrencyRepository mockCurrencyRepository = MockCurrencyRepository();
final NewsRepository mockNewsRepository = MockNewsRepository();
final SettingsRepository mockSettingsRepository = MockSettingsRepository();

// –ò—Å—Ç–æ—á–Ω–∏–∫–∏ –¥–∞–Ω–Ω—ã—Ö
final MockRestDatasource mockRestDatasource = MockRestDatasource();
final MockDbDatasource mockDbDatasource = MockDbDatasource();
final MockPreferenceDatasource mockPreferenceDatasource = MockPreferenceDatasource();
```

### –Æ–Ω–∏—Ç-—Ç–µ—Å—Ç—ã (Unit Tests)

–í –∫–∞—Ç–∞–ª–æ–≥–µ `test/unit/` –æ—Ä–≥–∞–Ω–∏–∑–æ–≤–∞–Ω—ã –º–æ–¥—É–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã, —Å–≥—Ä—É–ø–ø–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–æ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—é. –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –ª–æ–≥–∏—á–µ—Å–∫–∏ —Ä–∞–∑–¥–µ–ª–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏ (—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤) –∏ –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ (–º–∞–ø–ø–µ—Ä–æ–≤) –∏ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç —á–∏—Ç–∞–µ–º–æ—Å—Ç—å –∏ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ø—Ä–æ–µ–∫—Ç–∞.

#### –¢–µ—Å—Ç—ã –º–∞–ø–ø–µ—Ä–æ–≤ (`mapper_test/`)

–í –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ `test/unit/mapper_test/` —Ä–∞–∑–º–µ—â–µ–Ω—ã —Ç–µ—Å—Ç—ã, –ø—Ä–æ–≤–µ—Ä—è—é—â–∏–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è –º–æ–¥–µ–ª–µ–π (DTO, Entity) –∏ —Ç–∏–ø–æ–≤. –ú–∞–ø–ø–µ—Ä—ã ‚Äî —ç—Ç–æ –∫–ª—é—á–µ–≤—ã–µ –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ –∫–ª–∞—Å—Å—ã, –æ–±–µ—Å–ø–µ—á–∏–≤–∞—é—â–∏–µ —Å–≤—è–∑—å –º–µ–∂–¥—É —Å–ª–æ—è–º–∏ `data` –∏ `domain`.

–°–æ–∑–¥–∞–Ω—ã —Å–ª–µ–¥—É—é—â–∏–µ —Ñ–∞–π–ª—ã:

- `app_theme_mode_mapper_test.dart` ‚Äî —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ –º–µ–∂–¥—É `String` –∏ –ø–µ—Ä–µ—á–∏—Å–ª–µ–Ω–∏–µ–º `AppThemeMode`

```dart
import 'package:flutter_test/flutter_test.dart';
import 'package:mad_flutter_practicum/data/datasource_impl/preference_datasource_impl/mapper/app_theme_mode_mapper.dart';
import 'package:mad_flutter_practicum/data/datasource_impl/preference_datasource_impl/model/app_theme_mode_dao.dart';
import 'package:mad_flutter_practicum/domain/model/app_theme_mode.dart';

void main() {
  void run(String? input, AppThemeMode expectedMode) {
    test('AppThemeModeDao.fromString("$input") should map to $expectedMode', () {
      final AppThemeModeDao mode = AppThemeModeDao.fromString(input);

      final result = mode.model;

      expect(result, expectedMode);
    });
  }

  group('AppThemeModeDao.fromString mapping tests', () {
    for (final mode in AppThemeMode.values) {
      run(mode.name, mode);
    }

    run(null, AppThemeMode.system);
  });
}
```

- `currency_dto_mapper_test.dart` ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ –º–∞–ø–ø–∏–Ω–≥–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ DTO-–º–æ–¥–µ–ª–∏ –≤–∞–ª—é—Ç—ã

```dart
import 'package:flutter_test/flutter_test.dart';
import 'package:mad_flutter_practicum/data/datasource_impl/rest_datasource_impl/mapper/currency_mapper.dart';
import 'package:mad_flutter_practicum/data/datasource_impl/rest_datasource_impl/model/currency_dto.dart';

void main() {
  group('CurrencyDto to CurrencyModel mapping', () {
    test('should correctly map all fields when valid JSON is provided', () {
      final json = {
        "ID": "R01235",
        "Nominal": 1,
        "Name": "–î–æ–ª–ª–∞—Ä –°–®–ê",
        "CharCode": "USD",
        "Value": 90.5,
        "Previous": 89.1
      };

      final dto = CurrencyDto.fromJson(json);

      final model = dto.model;

      expect(model.id, 'R01235');
      expect(model.nominal, 1);
      expect(model.name, '–î–æ–ª–ª–∞—Ä –°–®–ê');
      expect(model.symbol, 'USD');
      expect(model.value, 90.5);
      expect(model.previousValue, 89.1);
    });

    test('should set default values when JSON is empty', () {
      final json = <String, dynamic>{};

      final dto = CurrencyDto.fromJson(json);
      final model = dto.model;

      expect(model.id, '');
      expect(model.nominal, 0);
      expect(model.name, '');
      expect(model.symbol, '');
      expect(model.value, 0);
      expect(model.previousValue, 0);
    });
  });
}
```

- `currency_model_db_mapper_test.dart` ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è –≤–∞–ª—é—Ç–Ω–æ–π –º–æ–¥–µ–ª–∏ –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–ª—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –∏ –æ–±—Ä–∞—Ç–Ω–æ

```dart
import 'package:flutter_test/flutter_test.dart';
import 'package:mad_flutter_practicum/data/datasource_impl/sqflite_datasorce_impl/mapper/currency_model_mapper.dart';
import 'package:mad_flutter_practicum/domain/model/currency_model.dart';

void main() {
  group('CurrencyModelDbMapper conversions', () {
    const testModel = CurrencyModel(
      id: 'USD',
      name: '–î–æ–ª–ª–∞—Ä –°–®–ê',
      symbol: 'USD',
      value: 90.5,
      nominal: 1,
      previousValue: 89.1,
    );

    final testMap = {
      'id': 'USD',
      'name': '–î–æ–ª–ª–∞—Ä –°–®–ê',
      'symbol': 'USD',
      'value': 90.5,
      'nominal': 1,
      'previousValue': 89.1,
    };

    test('correctly converts model to map', () {
      final map = testModel.toMap();

      expect(map, testMap);
    });

    test('correctly converts map to model', () {
      final model = CurrencyModelDbMapper.fromMap(testMap);

      expect(model.id, testModel.id);
      expect(model.name, testModel.name);
      expect(model.symbol, testModel.symbol);
      expect(model.value, testModel.value);
      expect(model.nominal, testModel.nominal);
      expect(model.previousValue, testModel.previousValue);
    });

    test('toMap and fromMap are inverses', () {
      final map = testModel.toMap();
      final restoredModel = CurrencyModelDbMapper.fromMap(map);

      expect(restoredModel, isA<CurrencyModel>());
      expect(restoredModel.id, testModel.id);
      expect(restoredModel.name, testModel.name);
      expect(restoredModel.symbol, testModel.symbol);
      expect(restoredModel.value, testModel.value);
      expect(restoredModel.nominal, testModel.nominal);
      expect(restoredModel.previousValue, testModel.previousValue);
    });
  });
}
```

- `news_item_mapper_test.dart` ‚Äî —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è —ç–ª–µ–º–µ–Ω—Ç–æ–≤ RSS-–ª–µ–Ω—Ç—ã –≤ –º–æ–¥–µ–ª—å –Ω–æ–≤–æ—Å—Ç–∏

```dart
import 'package:flutter_test/flutter_test.dart';
import 'package:mad_flutter_practicum/data/datasource_impl/rest_datasource_impl/constants.dart';
import 'package:mad_flutter_practicum/data/datasource_impl/rest_datasource_impl/mapper/news_mapper.dart';
import 'package:rss_dart/domain/rss_item.dart';
import 'package:intl/intl.dart';

void main() {
  group('RssItem to NewsModel mapping', () {
    test('maps valid RssItem with complete data correctly', () {
      final rssItem = RssItem(
        title: 'Test title',
        link: 'https://example.com/news',
        pubDate: 'Fri, 21 Jun 2024 12:00:00 +0300',
      );

      final model = rssItem.asNewsModel;

      expect(model.title, 'Test title');
      expect(model.link, 'https://example.com/news');
      expect(
        model.date,
        DateFormat(RestConstants.newsDateTimeFormat).parse('Fri, 21 Jun 2024 12:00:00 +0300'),
      );
    });

    test('handles null fields with default values', () {
      final rssItem = RssItem(
        title: null,
        link: null,
        pubDate: null,
      );

      final model = rssItem.asNewsModel;

      expect(model.title, '');
      expect(model.link, '');
      expect(model.date, isNull);
    });
  });
}
```

#### –¢–µ—Å—Ç—ã —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤

–í —Ñ–∞–π–ª–µ `test/unit/repository_test.dart` —Ä–∞–∑–º–µ—â–∞—é—Ç—Å—è –º–æ–¥—É–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤. –≠—Ç–∏ –∫–ª–∞—Å—Å—ã —Ä–µ–∞–ª–∏–∑—É—é—Ç –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É –∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö (—Å–µ—Ç–µ–≤—ã–º–∏ –∏–ª–∏ –ª–æ–∫–∞–ª—å–Ω—ã–º–∏). –î–ª—è –∏–∑–æ–ª—è—Ü–∏–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è mock-–æ–±—ä–µ–∫—Ç—ã –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π.

- `currency_repository_test.dart` ‚Äî —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –º–µ—Ç–æ–¥–æ–≤ –ø–æ–ª—É—á–µ–Ω–∏—è –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤–∞–ª—é—Ç

```dart
import 'package:flutter_test/flutter_test.dart';
import 'package:mad_flutter_practicum/data/repository_impl/currency_repository_impl.dart';
import 'package:mad_flutter_practicum/data/repository_impl/news_repository_impl.dart';
import 'package:mad_flutter_practicum/data/repository_impl/settings_repository_impl.dart';
import 'package:mad_flutter_practicum/domain/model/app_theme_mode.dart';
import 'package:mad_flutter_practicum/domain/model/news_model.dart';
import 'package:mad_flutter_practicum/domain/repository/currency_repository.dart';
import 'package:mad_flutter_practicum/domain/repository/news_repository.dart';
import 'package:mad_flutter_practicum/domain/repository/settings_repository.dart';
import 'package:mockito/mockito.dart';
import 'package:mad_flutter_practicum/domain/model/currency_model.dart';

import '../mocks/datasource.mocks.dart';

void main() {
  final MockRestDatasource mockRestDatasource = MockRestDatasource();
  final MockDbDatasource mockDbDatasource = MockDbDatasource();
  final MockPreferenceDatasource mockPreferenceDatasource = MockPreferenceDatasource();

  group('CurrencyRepository', () {
    late CurrencyRepository repository;

    setUp(() {
      repository = CurrencyRepositoryImpl(mockRestDatasource, mockDbDatasource);
    });

    test('should return correct currency list when getCurrencyList is called', () async {
      final currencyList = [
        CurrencyModel(
          id: '1',
          nominal: 1,
          name: '–î–æ–ª–ª–∞—Ä –°–®–ê',
          symbol: 'USD',
          value: 78.4181,
          previousValue: 78.5,
        ),
        CurrencyModel(
          id: '2',
          nominal: 1,
          name: '–ï–≤—Ä–æ',
          symbol: 'EUR',
          value: 92.7440,
          previousValue: 92.2,
        ),
      ];

      when(mockRestDatasource.getCurrencyList()).thenAnswer((_) async => currencyList);

      final result = await repository.getCurrencyList();

      expect(result, currencyList);
      verify(mockRestDatasource.getCurrencyList()).called(1);
    });

    test('should complete successfully when saveCurrencyList is called', () async {
      final currencyList = [
        CurrencyModel(
          id: '1',
          nominal: 1,
          name: '–Æ–∞–Ω—å',
          symbol: 'CNY',
          value: 10.9384,
          previousValue: 10.9112,
        ),
      ];

      await repository.saveCurrencyList(currencyList);

      verify(mockDbDatasource.saveCurrencyList(currencyList)).called(1);
    });
  });

  group('NewsRepository', () {
    late NewsRepository repository;

    setUp(() {
      repository = NewsRepositoryImpl(mockRestDatasource, mockDbDatasource);
    });

    test('should return news list when getNewsList is called', () async {
      final newsList = [
        for (int i = 0; i < 3; i++)
          NewsModel(title: '–ó–∞–≥–æ–ª–æ–≤–æ–∫ $i', link: 'https://example.com/$i', date: DateTime.now()),
      ];

      when(mockRestDatasource.getNewsList()).thenAnswer((_) async => newsList);

      final result = await repository.getNewsList();

      expect(result, newsList);
      verify(mockRestDatasource.getNewsList()).called(1);
    });

    test('should complete successfully when saveNewsList is called', () async {
      final newsList = [
        NewsModel(title: '–ó–∞–≥–æ–ª–æ–≤–æ–∫ 1', link: 'https://example.com/1', date: DateTime.now()),
      ];

      await repository.saveNewsList(newsList);

      verify(mockDbDatasource.saveNewsList(newsList)).called(1);
    });
  });

  group('SettingsRepository', () {
    late SettingsRepository settingsRepository;

    setUp(() {
      settingsRepository = SettingsRepositoryImpl(mockPreferenceDatasource);
    });

    test('should complete initialization without errors', () async {
      when(mockPreferenceDatasource.getToken()).thenAnswer((_) => Future.value('my-token'));

      await settingsRepository.initAsyncData();

      verify(settingsRepository.initAsyncData()).called(1);
    });

    test('should return correct token when getToken is called', () async {
      when(mockPreferenceDatasource.getToken()).thenAnswer((_) => Future.value('my-token'));

      final token = await settingsRepository.getToken();

      expect(token, 'my-token');
      verify(settingsRepository.getToken()).called(1);
    });

    test('should complete token setting successfully', () async {
      await settingsRepository.setToken('abc');

      verify(mockPreferenceDatasource.setToken('abc')).called(1);
    });

    test('should set theme mode with correct value', () {
      settingsRepository.setThemeMode(AppThemeMode.dark);

      verify(mockPreferenceDatasource.setThemeMode(AppThemeMode.dark)).called(1);
    });

    test('should return current theme mode value', () {
      when(mockPreferenceDatasource.themeMode).thenReturn(AppThemeMode.light);

      final result = settingsRepository.themeMode;

      expect(result, AppThemeMode.light);
      verify(mockPreferenceDatasource.themeMode).called(1);
    });

    test('should emit theme mode changes through stream', () async {
      final stream = Stream<AppThemeMode>.fromIterable([
        AppThemeMode.system,
        AppThemeMode.dark,
      ]);

      expectLater(
        settingsRepository.themeModeStream,
        emitsInOrder([AppThemeMode.system, AppThemeMode.dark]),
      );

      await for (final mode in stream) {
        settingsRepository.setThemeMode(mode);
      }
    });

    test('should emit auth state changes through stream', () async {
      final stream = Stream<String?>.fromIterable(['token', null]);

      expectLater(
        settingsRepository.isAuthStream,
        emitsInOrder([true, false]),
      );

      await for (final token in stream) {
        settingsRepository.setToken(token);
      }
    });
  });
}
```

> ‚úÖ –ü—Ä–∏ –Ω–∞–ø–∏—Å–∞–Ω–∏–∏ –º–æ–¥—É–ª—å–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤ –º–∞–ø–ø–µ—Ä–æ–≤ –∏ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤ –≤–∞–∂–Ω–æ –Ω–µ —Ç–æ–ª—å–∫–æ –ø—Ä–æ–≤–µ—Ä—è—Ç—å –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è, –Ω–æ –∏ –≤–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –≤—ã–∑–æ–≤–æ–≤ –∏ –ø–µ—Ä–µ–¥–∞—á—É –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤.

### –í–∏–¥–∂–µ—Ç-—Ç–µ—Å—Ç—ã (Widget Tests)

–í–∏–¥–∂–µ—Ç-—Ç–µ—Å—Ç—ã –ø–æ–∑–≤–æ–ª—è—é—Ç –ø—Ä–æ–≤–µ—Ä—è—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏ –ø–æ–≤–µ–¥–µ–Ω–∏—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–Ω—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –≤ –∏–∑–æ–ª—è—Ü–∏–∏, –±–µ–∑ –∑–∞–ø—É—Å–∫–∞ –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è. –û–Ω–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç –±–∏–±–ª–∏–æ—Ç–µ–∫—É `flutter_test` –∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –≤ —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ–π headless-—Å—Ä–µ–¥–µ.

–í –ø—Ä–æ–µ–∫—Ç–µ –≤—Å–µ –≤–∏–¥–∂–µ—Ç-—Ç–µ—Å—Ç—ã —Å–≥—Ä—É–ø–ø–∏—Ä–æ–≤–∞–Ω—ã –≤ –∫–∞—Ç–∞–ª–æ–≥–µ `test/widget/`. –ö–∞–∂–¥—ã–π —Ç–µ—Å—Ç–æ–≤—ã–π —Ñ–∞–π–ª –ø–æ—Å–≤—è—â—ë–Ω –æ—Ç–¥–µ–ª—å–Ω–æ–º—É —ç–∫—Ä–∞–Ω—É –∏–ª–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—É –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞. –ù–∏–∂–µ –ø—Ä–∏–≤–µ–¥—ë–Ω –∫—Ä–∞—Ç–∫–∏–π –æ–±–∑–æ—Ä —Ñ–∞–π–ª–æ–≤:

- `widget.dart` - –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–π —Ñ–∞–π–ª –¥–ª—è –≤–∏–¥–∂–µ—Ç-—Ç–µ—Å—Ç–æ–≤. –°–æ–¥–µ—Ä–∂–∏—Ç —Ñ—É–Ω–∫—Ü–∏—é `buildWidget`, –∫–æ—Ç–æ—Ä–∞—è –æ–±–æ—Ä–∞—á–∏–≤–∞–µ—Ç –ø–µ—Ä–µ–¥–∞–Ω–Ω—ã–π –≤–∏–¥–∂–µ—Ç –≤ `MaterialApp` –∏ `MultiProvider` (–µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω—ã –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã). –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —É–¥–æ–±–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ –≤–∏–¥–∂–µ—Ç–æ–≤ –≤ —Ç–µ—Å—Ç–∞—Ö —Å –Ω—É–∂–Ω—ã–º –æ–∫—Ä—É–∂–µ–Ω–∏–µ–º.

```dart
import 'package:flutter/material.dart';
import 'package:provider/provider.dart';

Widget buildWidget({
  List<Provider> providers = const [],
  required Widget child,
}) =>
    MultiProvider(
      providers: providers,
      child: MaterialApp(
        home: child,
      ),
    );
```

- `currency_list_page_test.dart` ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞ –≤–∞–ª—é—Ç, –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å `FutureBuilder`, –Ω–∞–ª–∏—á–∏—è –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ —Å–ø–∏—Å–∫–∞

```dart
import 'package:flutter/material.dart';
import 'package:flutter_test/flutter_test.dart';
import 'package:intl/date_symbol_data_local.dart';
import 'package:mad_flutter_practicum/app/constants.dart';
import 'package:mad_flutter_practicum/app/currency_detail/currency_detail_page.dart';
import 'package:mad_flutter_practicum/app/currency_list/currency_list_page.dart';
import 'package:mad_flutter_practicum/app/currency_list/widgets/currency_card.dart';
import 'package:mad_flutter_practicum/domain/model/currency_model.dart';
import 'package:mad_flutter_practicum/domain/repository/currency_repository.dart';
import 'package:mockito/mockito.dart';
import 'package:provider/provider.dart';

import '../mocks/repository.mocks.dart';
import 'widget.dart';

Future<void> main() async {
  await initializeDateFormatting(AppConstants.ruLocale, null);

  group('CurrencyListPage', () {
    final MockCurrencyRepository mockCurrencyRepository = MockCurrencyRepository();

    final currencyItems = [
      CurrencyModel(
        id: '1',
        nominal: 1,
        name: '–î–æ–ª–ª–∞—Ä –°–®–ê',
        symbol: 'USD',
        value: 78.4181,
        previousValue: 78.5,
      ),
      CurrencyModel(
        id: '2',
        nominal: 1,
        name: '–ï–≤—Ä–æ',
        symbol: 'EUR',
        value: 92.7440,
        previousValue: 92.2,
      ),
    ];

    setUp(() {
      when(mockCurrencyRepository.getCurrencyList()).thenAnswer((_) async => currencyItems);
      when(mockCurrencyRepository.saveCurrencyList(any)).thenAnswer((_) async {});
    });

    testWidgets('should display all currency items when loaded', (WidgetTester tester) async {
      await tester.pumpWidget(
        buildWidget(
          providers: [
            Provider<CurrencyRepository>.value(value: mockCurrencyRepository),
          ],
          child: CurrencyListPage(),
        ),
      );

      await tester.pumpAndSettle();

      expect(find.text('USD'), findsOneWidget);
      expect(find.text('EUR'), findsOneWidget);
      expect(find.text('JPY'), findsNothing);
      expect(find.byType(CurrencyCard), findsNWidgets(currencyItems.length));
    });

    testWidgets('should navigate to detail page when currency card is tapped', (WidgetTester tester) async {
      await tester.pumpWidget(
        buildWidget(
          providers: [
            Provider<CurrencyRepository>.value(value: mockCurrencyRepository),
          ],
          child: const CurrencyListPage(),
        ),
      );

      await tester.pumpAndSettle();
      await tester.tap(find.byType(CurrencyCard).first);
      await tester.pumpAndSettle();

      expect(find.byType(CurrencyDetailPage), findsOneWidget);
    });

    testWidgets('should filter currencies when search text is entered', (WidgetTester tester) async {
      await tester.pumpWidget(
        buildWidget(
          providers: [
            Provider<CurrencyRepository>.value(value: mockCurrencyRepository),
          ],
          child: const CurrencyListPage(),
        ),
      );

      await tester.pumpAndSettle();
      await tester.enterText(find.byType(TextField), '–ï–≤—Ä–æ');
      await tester.pump();

      expect(find.byType(CurrencyCard), findsOneWidget);
    });
  });
}
```

- `news_list_page_test.dart` ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞ –Ω–æ–≤–æ—Å—Ç–µ–π, –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∫–∞—Ä—Ç–æ—á–µ–∫ –∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –Ω–∞–ª–∏—á–∏—è –¥–∞–Ω–Ω—ã—Ö

```dart
import 'package:flutter_test/flutter_test.dart';
import 'package:intl/date_symbol_data_local.dart';
import 'package:mad_flutter_practicum/app/constants.dart';
import 'package:mad_flutter_practicum/app/news_list/news_list_page.dart';
import 'package:mad_flutter_practicum/domain/model/news_model.dart';
import 'package:mad_flutter_practicum/domain/repository/news_repository.dart';
import 'package:mockito/mockito.dart';
import 'package:provider/provider.dart';

import '../mocks/repository.mocks.dart';
import 'widget.dart';

Future<void> main() async {
  await initializeDateFormatting(AppConstants.ruLocale, null);

  group('NewsListPage', () {
    final MockNewsRepository mockNewsRepository = MockNewsRepository();

    final newsItems = [
      NewsModel(title: '–ó–∞–≥–æ–ª–æ–≤–æ–∫ 1', link: 'https://example.com/1', date: DateTime.now()),
      NewsModel(title: '–ó–∞–≥–æ–ª–æ–≤–æ–∫ 2', link: 'https://example.com/2', date: DateTime.now()),
    ];

    setUp(() {
      when(mockNewsRepository.getNewsList()).thenAnswer((_) async => newsItems);
      when(mockNewsRepository.saveNewsList(any)).thenAnswer((_) async {});
    });

    testWidgets('should display all news items when loaded', (WidgetTester tester) async {
      await tester.pumpWidget(
        buildWidget(
          providers: [
            Provider<NewsRepository>.value(value: mockNewsRepository),
          ],
          child: const NewsListPage(),
        ),
      );

      await tester.pumpAndSettle();

      expect(find.text('–ó–∞–≥–æ–ª–æ–≤–æ–∫ 1'), findsOneWidget);
      expect(find.text('–ó–∞–≥–æ–ª–æ–≤–æ–∫ 2'), findsOneWidget);
      expect(find.text('–ó–∞–≥–æ–ª–æ–≤–æ–∫ 3'), findsNothing);
    });
  });
}
```

- `login_page_test.dart` ‚Äî —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏, –≤ —Ç–æ–º —á–∏—Å–ª–µ –Ω–∞–ª–∏—á–∏—è –∫–Ω–æ–ø–∫–∏ –≤—Ö–æ–¥–∞ –∏ –≤—ã–∑–æ–≤–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–≥–æ –º–µ—Ç–æ–¥–∞ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è –ø—Ä–∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–∏

```dart
import 'package:flutter_test/flutter_test.dart';
import 'package:mad_flutter_practicum/app/login_page.dart';
import 'package:mad_flutter_practicum/data/repository_impl/settings_repository_impl.dart';
import 'package:mad_flutter_practicum/domain/repository/settings_repository.dart';
import 'package:mockito/mockito.dart';
import 'package:provider/provider.dart';

import '../mocks/datasource.mocks.dart';

import 'widget.dart';

void main() {
  final MockPreferenceDatasource mockPreferenceDatasource = MockPreferenceDatasource();

  late SettingsRepository settingsRepository;

  setUp(() {
    settingsRepository = SettingsRepositoryImpl(mockPreferenceDatasource);
  });

  group('LoginPage', () {
    testWidgets('should call setToken when login button is tapped', (WidgetTester tester) async {
      await tester.pumpWidget(
        buildWidget(
          providers: [
            Provider<SettingsRepository>.value(value: settingsRepository),
          ],
          child: const LoginPage(),
        ),
      );

      final loginButton = find.text('–í–æ–π—Ç–∏');
      expect(loginButton, findsOneWidget);

      verifyNever(settingsRepository.setToken(any));

      await tester.tap(loginButton);

      verify(settingsRepository.setToken(any)).called(1);
    });
  });
}
```

- `home_container_test.dart` ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–∏–∫–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –≤–∫–ª–∞–¥–æ–∫ –Ω–∏–∂–Ω–µ–π –Ω–∞–≤–∏–≥–∞—Ü–∏–∏, –∞ —Ç–∞–∫–∂–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —ç–∫—Ä–∞–Ω–∞

```dart
import 'package:flutter/material.dart';
import 'package:flutter_test/flutter_test.dart';
import 'package:mad_flutter_practicum/app/currency_list/currency_list_page.dart';
import 'package:mad_flutter_practicum/app/home.dart';
import 'package:mad_flutter_practicum/app/news_list/news_list_page.dart';
import 'package:mad_flutter_practicum/app/profile/profile_page.dart';
import 'package:mad_flutter_practicum/domain/model/app_theme_mode.dart';
import 'package:mad_flutter_practicum/domain/repository/currency_repository.dart';
import 'package:mad_flutter_practicum/domain/repository/news_repository.dart';
import 'package:mad_flutter_practicum/domain/repository/settings_repository.dart';
import 'package:mockito/mockito.dart';
import 'package:provider/provider.dart';

import '../mocks/repository.mocks.dart';
import 'widget.dart';

void main() {
  group('HomePage', () {
    final MockCurrencyRepository mockCurrencyRepository = MockCurrencyRepository();
    final MockNewsRepository mockNewsRepository = MockNewsRepository();
    final MockSettingsRepository mockSettingsRepository = MockSettingsRepository();

    final ImageProvider homeImage = Image.asset('assets/icons/home.png').image;
    final ImageProvider newsImage = Image.asset('assets/icons/news.png').image;
    final IconData profileIcon = Icons.person;

    late Widget homeWidget;

    setUp(() {
      homeWidget = buildWidget(
        providers: [
          Provider<CurrencyRepository>.value(value: mockCurrencyRepository),
          Provider<NewsRepository>.value(value: mockNewsRepository),
          Provider<SettingsRepository>.value(value: mockSettingsRepository),
        ],
        child: const HomePage(),
      );

      when(mockCurrencyRepository.getCurrencyList()).thenAnswer((_) async => []);
      when(mockNewsRepository.getNewsList()).thenAnswer((_) async => []);
      when(mockSettingsRepository.themeMode).thenAnswer((_) => AppThemeMode.system);
    });

    testWidgets('should display all navigation tabs with correct labels and icons', (WidgetTester tester) async {
      await tester.pumpWidget(homeWidget);
      await tester.pumpAndSettle();

      expect(find.widgetWithText(BottomNavigationBar, '–ù–æ–≤–æ—Å—Ç–∏'), findsOneWidget);
      expect(find.widgetWithText(BottomNavigationBar, '–ö—É—Ä—Å –í–∞–ª—é—Ç'), findsOneWidget);
      expect(find.widgetWithText(BottomNavigationBar, '–ü—Ä–æ—Ñ–∏–ª—å'), findsOneWidget);

      expect(find.widgetWithImage(BottomNavigationBar, homeImage), findsOneWidget);
      expect(find.widgetWithImage(BottomNavigationBar, newsImage), findsOneWidget);
      expect(find.widgetWithIcon(BottomNavigationBar, profileIcon), findsOneWidget);
    });

    testWidgets('should navigate to correct pages when tabs are tapped', (WidgetTester tester) async {
      await tester.pumpWidget(homeWidget);
      await tester.pumpAndSettle();

      await tester.tap(find.image(homeImage));
      await tester.pumpAndSettle();
      expect(find.byType(CurrencyListPage), findsOneWidget);

      await tester.tap(find.image(newsImage));
      await tester.pumpAndSettle();
      expect(find.byType(NewsListPage), findsOneWidget);

      await tester.tap(find.byIcon(profileIcon));
      await tester.pumpAndSettle();
      expect(find.byType(ProfilePage), findsOneWidget);
    });
  });
}
```

> ‚úÖ –í–∞–∂–Ω–æ –ø–æ–º–Ω–∏—Ç—å, —á—Ç–æ –≤–∏–¥–∂–µ—Ç-—Ç–µ—Å—Ç—ã –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è –≤ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ–π —Å—Ä–µ–¥–µ, –ø–æ—ç—Ç–æ–º—É –ª—é–±—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (–≤–∫–ª—é—á–∞—è —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –∏ –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã) –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –ø–æ–¥–º–µ–Ω–µ–Ω—ã –≤—Ä—É—á–Ω—É—é —á–µ—Ä–µ–∑ –æ–±—ë—Ä—Ç–∫–∏ –∏–ª–∏ mock-–æ–±—ä–µ–∫—Ç—ã.

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã (Integration Tests)

–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã –º–æ–¥–µ–ª–∏—Ä—É—é—Ç –ø–æ–≤–µ–¥–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∏ –ø–æ–∑–≤–æ–ª—è—é—Ç –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É –Ω–∞–≤–∏–≥–∞—Ü–∏–∏, –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ –º–µ–∂–¥—É —ç–∫—Ä–∞–Ω–∞–º–∏, —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏ —Ä–µ–∞–∫—Ü–∏—é –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –¥–µ–π—Å—Ç–≤–∏—è –≤–∂–∏–≤—É—é. –¢–∞–∫–∏–µ —Ç–µ—Å—Ç—ã –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è –Ω–µ –≤ —Ç–µ—Å—Ç–æ–≤–æ–π —Å—Ä–µ–¥–µ, –∞ –Ω–∞ –Ω–∞—Å—Ç–æ—è—â–µ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ –∏–ª–∏ —ç–º—É–ª—è—Ç–æ—Ä–µ, –∏, –≤ –æ—Ç–ª–∏—á–∏–µ –æ—Ç unit –∏ widget-—Ç–µ—Å—Ç–æ–≤, —Ä–∞–±–æ—Ç–∞—é—Ç —Å –ø–æ–ª–Ω—ã–º —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

#### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∏ —Ä–∞–∑–º–µ—â–µ–Ω–∏–µ

–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã —Ä–∞–∑–º–µ—â–∞—é—Ç—Å—è –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ `integration_test/`, —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–Ω–æ–π –Ω–∞ –æ–¥–Ω–æ–º —É—Ä–æ–≤–Ω–µ —Å –ø–∞–ø–∫–æ–π `test/`. –≠—Ç–æ —Å–¥–µ–ª–∞–Ω–æ –Ω–∞–º–µ—Ä–µ–Ω–Ω–æ –ø–æ—Å–∫–æ–ª—å–∫—É:

- –∫–∞—Ç–∞–ª–æ–≥ `test/` –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –¥–ª—è —Ç–µ—Å—Ç–æ–≤, –≤—ã–ø–æ–ª–Ω—è–µ–º—ã—Ö –≤ —Å—Ä–µ–¥–µ `flutter test`;
- –∫–∞—Ç–∞–ª–æ–≥ `integration_test/` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Ç–µ—Å—Ç–æ–≤, –∑–∞–ø—É—Å–∫–∞–µ–º—ã—Ö —á–µ—Ä–µ–∑ `flutter test integration_test` –∏–ª–∏ `flutter drive`, –∏ —Ç—Ä–µ–±—É–µ—Ç –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è.

> üìå –¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, Flutter —á—ë—Ç–∫–æ —Ä–∞–∑–¥–µ–ª—è–µ—Ç –¥–≤–∞ —Ä–µ–∂–∏–º–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è: –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ (`flutter test`) –∏ –ø–æ–ª–Ω–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ (`flutter test integration_test`).

#### –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏

- `app_test.dart` ‚Äî –æ—Å–Ω–æ–≤–Ω–æ–π —Ñ–∞–π–ª —Å —Ç–µ—Å—Ç–∞–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤. –ó–¥–µ—Å—å –º–æ–¥–µ–ª–∏—Ä—É—é—Ç—Å—è –¥–µ–π—Å—Ç–≤–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –Ω–∞–ø—Ä–∏–º–µ—Ä: –∑–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, –≤—Ö–æ–¥, –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ç–µ–º—ã, –ø–µ—Ä–µ—Ö–æ–¥ –ø–æ –≤–∫–ª–∞–¥–∫–∞–º –∏ —Ç.–¥.

```dart
import 'package:flutter/material.dart';
import 'package:flutter_secure_storage/flutter_secure_storage.dart';
import 'package:flutter_test/flutter_test.dart';
import 'package:integration_test/integration_test.dart';
import 'package:intl/date_symbol_data_local.dart';
import 'package:mad_flutter_practicum/app/constants.dart';
import 'package:mad_flutter_practicum/app/currency_list/widgets/currency_card.dart';
import 'package:mad_flutter_practicum/app/login_page.dart';
import 'package:mad_flutter_practicum/app/news_list/widgets/news_card.dart';
import 'package:mad_flutter_practicum/data/datasource_impl/preference_datasource_impl/preference_datasource_impl.dart';
import 'package:mad_flutter_practicum/data/datasource_impl/rest_datasource_impl/rest_datasource_impl.dart';
import 'package:mad_flutter_practicum/data/datasource_impl/sqflite_datasorce_impl/sqflite_datasource_impl.dart';
import 'package:mad_flutter_practicum/main.dart';
import 'package:shared_preferences/shared_preferences.dart';

Future<void> main() async {
  IntegrationTestWidgetsFlutterBinding.ensureInitialized();

  await initializeDateFormatting(AppConstants.ruLocale, null);

  final sharedPreferences = await SharedPreferences.getInstance();
  final secureStorage = FlutterSecureStorage();

  final restDatasource = RestDatasourceImpl();
  final dbDatasource = SqfliteDatasourceImpl();
  final preferenceDatasource = PreferenceDatasourceImpl(sharedPreferences, secureStorage);

  const Duration commonDuration = Duration(seconds: 1);
  const Duration longDuration = Duration(seconds: 3);

  Future<void> login(WidgetTester tester) async {
    final loginButton = find.widgetWithText(ElevatedButton, '–í–æ–π—Ç–∏');
    await tester.tap(loginButton);
    await tester.pumpAndSettle(longDuration);
  }

  Future<void> checkHomeContainer(WidgetTester tester) async {
    expect(find.widgetWithText(BottomNavigationBar, '–ù–æ–≤–æ—Å—Ç–∏'), findsOneWidget);
    expect(find.widgetWithText(BottomNavigationBar, '–ö—É—Ä—Å –í–∞–ª—é—Ç'), findsOneWidget);
    expect(find.widgetWithText(BottomNavigationBar, '–ü—Ä–æ—Ñ–∏–ª—å'), findsOneWidget);
  }

  Future<void> checkCurrencyListPage(WidgetTester tester) async {
    await tester.tap(find.byType(CurrencyCard).first);
    await tester.pumpAndSettle(commonDuration);
    await tester.tap(find.widgetWithIcon(IconButton, Icons.arrow_back));
    await tester.pumpAndSettle(commonDuration);
  }

  Future<void> checkNewsListPage(WidgetTester tester) async {
    await tester.tap(find.image(Image.asset('assets/icons/news.png').image));
    await tester.pumpAndSettle(longDuration);

    expect(find.byType(NewsCard), findsWidgets);
  }

  Future<void> checkProfilePage(WidgetTester tester) async {
    await tester.tap(find.byIcon(Icons.person));
    await tester.pumpAndSettle(commonDuration);
    await tester.tap(find.widgetWithText(ElevatedButton, '–í—ã–π—Ç–∏'));
    await tester.pumpAndSettle(commonDuration);
  }

  testWidgets('should complete full user flow successfully', (tester) async {
    await tester.pumpWidget(
      GlobalProviders(
        restDatasource: restDatasource,
        dbDatasource: dbDatasource,
        preferenceDatasource: preferenceDatasource,
        child: const App(),
      ),
    );

    await tester.pumpAndSettle(longDuration);

    await login(tester);
    await checkHomeContainer(tester);
    await checkCurrencyListPage(tester);
    await checkNewsListPage(tester);
    await checkProfilePage(tester);

    expect(find.byType(LoginPage), findsOneWidget);
  });
}
```

> ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã –æ—Å–æ–±–µ–Ω–Ω–æ –ø–æ–ª–µ–∑–Ω—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ü–µ–ø–æ—á–µ–∫ —ç–∫—Ä–∞–Ω–æ–≤, —Ä–∞–±–æ—Ç—ã —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –ø–ª–∞–≥–∏–Ω–∞–º–∏ (SharedPreferences, HTTP, SQLite) –∏ –æ–±—â–µ–π —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –ø—Ä–∏ –¥–ª–∏—Ç–µ–ª—å–Ω–æ–π —Å–µ—Å—Å–∏–∏.

## 4. –°–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–∞—è —á–∞—Å—Ç—å

> –ü–µ—Ä–µ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ–º –∑–∞–¥–∞–Ω–∏—è —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –≤—ã–±—Ä–∞—Ç—å —Ü–µ–ª–µ–≤–æ–π —É—Ä–æ–≤–µ–Ω—å (–æ—Ü–µ–Ω–∫—É), —á—Ç–æ –ø–æ–∑–≤–æ–ª–∏—Ç –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –≥–ª—É–±–∏–Ω—É –ø—Ä–æ—Ä–∞–±–æ—Ç–∫–∏ –∏ —Ç—Ä—É–¥–æ—ë–º–∫–æ—Å—Ç—å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏. –í—Å–µ —É—Ä–æ–≤–Ω–∏ –æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω—ã –Ω–∞ –∑–∞–∫—Ä–µ–ø–ª–µ–Ω–∏–µ –∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ –∑–Ω–∞–Ω–∏–π –≤ –æ–±–ª–∞—Å—Ç–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è Flutter-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π.

### –ó–∞–¥–∞–Ω–∏–µ –Ω–∞ –æ—Ü–µ–Ω–∫—É "3"

- –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –≤—Å–µ —Ç–µ—Å—Ç–æ–≤—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏, –æ–ø–∏—Å–∞–Ω–Ω—ã–µ –≤ –æ—Å–Ω–æ–≤–Ω–æ–π —á–∞—Å—Ç–∏ –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–æ–π —Ä–∞–±–æ—Ç—ã.
- –ó–∞–º–µ–Ω–∏—Ç–µ –º–æ–∫–æ–≤—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –¥–∞–Ω–Ω—ã—Ö –≤ unit-—Ç–µ—Å—Ç–∞—Ö –Ω–∞ —Ñ–µ–π–∫–æ–≤—ã–µ (fake):
  - `FakeRestDatasource`
  - `FakeDbDatasource`
  - `FakePreferenceDatasource`

> ‚ÑπÔ∏è **–§–µ–π–∫–∏ (fake)** ‚Äî —ç—Ç–æ —É–ø—Ä–æ—â—ë–Ω–Ω—ã–µ, –≤—Ä—É—á–Ω—É—é —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –≤–µ—Ä—Å–∏–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π, –ø–æ–≤–µ–¥–µ–Ω–∏–µ –∫–æ—Ç–æ—Ä—ã—Ö –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—Ç—Å—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–º. –í –æ—Ç–ª–∏—á–∏–µ –æ—Ç mock-–æ–±—ä–µ–∫—Ç–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è –∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–µ–Ω–Ω–æ –≤ —é–Ω–∏—Ç-—Ç–µ—Å—Ç–∞—Ö, —Ñ–µ–π–∫–∏ –æ–±—ã—á–Ω–æ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –≤ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–∞—Ö –∏ —Å–æ–¥–µ—Ä–∂–∞—Ç –º–∏–Ω–∏–º–∞–ª—å–Ω–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º—É—é –ª–æ–≥–∏–∫—É, –∏–º–∏—Ç–∏—Ä—É—é—â—É—é —Ä–∞–±–æ—Ç—É —Ä–µ–∞–ª—å–Ω–æ–≥–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞. –ò—Ö –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–æ ‚Äî —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å –∏ —á–∏—Ç–∞–µ–º–æ—Å—Ç—å –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º.
–ó–∞ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –º–æ–∂–Ω–æ –æ–±—Ä–∞—Ç–∏—Ç—å—Å—è –∫ [–æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–º —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è–º –ø–æ –Ω–∞–ø–∏—Å–∞–Ω–∏—é —Ñ–µ–π–∫–æ–≤](https://pub.dev/packages/mockito#writing-a-fake) –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ `mockito`.

### –ó–∞–¥–∞–Ω–∏–µ –Ω–∞ –æ—Ü–µ–Ω–∫—É "4"

–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –∫ –ø—Ä–µ–¥—ã–¥—É—â–∏–º —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º:

- –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å widget-—Ç–µ—Å—Ç—ã –¥–ª—è —Å—Ü–µ–Ω–∞—Ä–∏—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ç–µ–º—ã –Ω–∞ —ç–∫—Ä–∞–Ω–µ `ProfilePage`.
- –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞, –ø—Ä–æ–≤–µ—Ä—è—é—â–∏–π –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ç–µ–º—ã –Ω–∞ —ç–∫—Ä–∞–Ω–µ `ProfilePage`.

> –†–µ–∑—É–ª—å—Ç–∞—Ç –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ç–µ–º—ã –Ω—É–∂–Ω–æ —Å—Ä–∞–≤–Ω–∏–≤–∞—Ç—å —Å `Theme.of(tester.element).brightness`

### –ó–∞–¥–∞–Ω–∏–µ –Ω–∞ –æ—Ü–µ–Ω–∫—É "5"

–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –∫ –ø—Ä–µ–¥—ã–¥—É—â–∏–º —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º:

- –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å golden-—Ç–µ—Å—Ç—ã –¥–ª—è –∫–ª—é—á–µ–≤—ã—Ö —ç–∫—Ä–∞–Ω–æ–≤:
  - `SplashPage`
  - `LoginPage`
  - `ProfilePage`
  - `CurrencyListPage`
  - `NewsListPage`
  - `HomePage`

> –î–ª—è —Ç–æ–≥–æ —á—Ç–æ–±—ã –ø–æ–¥–æ—Ä–æ–±–Ω–µ–µ —É–∑–Ω–∞—Ç—å —á—Ç–æ —Ç–∞–∫–æ–µ golden-—Ç–µ—Å—Ç—ã —Ä–µ–∫–æ–º–µ–Ω–¥—É—é –æ–±—Ä–∞—Ç–∏—Ç—å—Å—è –∫ –º–∞—Ç–µ—Ä–∏–∞–ª–∞–º –Ω–∏–∂–µ.

**–ú–∞—Ç–µ—Ä–∏–∞–ª—ã**

1. [–°—Ç–∞—Ç—å—è Medium `Golden tests in Flutter`](https://medium.com/profusion-engineering/golden-tests-in-flutter-a-comprehensive-guide-b4b50a932fd5) [1]
2. [–û–±—É—á–∞—é—â–µ–µ –≤–∏–¥–µ–æ –æ—Ç `Mad Brains`](https://www.youtube.com/watch?v=thnLmxQGGRY)
3. [–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è `golden_toolkit`](https://pub.dev/packages/golden_toolkit) [2]
4. [–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è `alchemist`](https://pub.dev/packages/alchemist)

> [1] ‚ö†Ô∏è –ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ `Medium` –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞ –Ω–∞ —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏–∏ –†–§ –±–µ–∑ VPN.

> [2] ‚ö†Ô∏è –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ `golden_toolkit` –≤ –Ω–∞—Å—Ç–æ—è—â–µ–µ –≤—Ä–µ–º—è –ø—Ä–∏–∑–Ω–∞–Ω–∞ —É—Å—Ç–∞—Ä–µ–≤—à–µ–π –∏ –±–æ–ª—å—à–µ –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è. –í–º–µ—Å—Ç–æ –Ω–µ—ë —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `alchemist`, –∫–∞–∫ –±–æ–ª–µ–µ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—É—é –∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—É—é –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—É.